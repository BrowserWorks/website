---
import Page from '~/components/ContentPage.svelte'
import { defaultLang, type locales } from '~/i18n/locales'
import { useTranslations, type Key } from '~/i18n/utils'
import Layout from '~/layouts/Content.astro'
import { getCollectionEntries } from '~/lib/collection'
import { orderBy, parseSemVer } from '~/lib/orderBy'

const { lang: detectedLang } = Astro.params
const lang = detectedLang as keyof typeof locales

let pages = orderBy(
	(await getCollectionEntries('docs', lang as keyof typeof locales)).filter(
		(page) => page.parent === 'releases'
	),
	(i: any) => parseSemVer(i.data.label),
	'desc'
)

if (!pages.length && lang?.toLowerCase() !== defaultLang?.toLowerCase()) {
	pages = orderBy(
		(await getCollectionEntries('docs', defaultLang as keyof typeof locales)).filter(
			(page) => page.parent === 'releases'
		),
		(i: any) => parseSemVer(i.data.label),
		'desc'
	)
}

if (!pages.length) return Astro.redirect(`/${lang}/docs/`)

const t = useTranslations(lang, { useKeyAsFallack: false })
const title = t('releases.meta.title' as Key)
const description = t('releases.meta.description' as Key)
---

<Layout {title} {description} collection="docs">
	{
		pages.map(({ data, href, Content }) => (
			<Page
				title={data.title}
				subtitle={data?.subtitle}
				titleLink={href?.replace(defaultLang, lang)}
			></Page>
		))
	}
</Layout>
